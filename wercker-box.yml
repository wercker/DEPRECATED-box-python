name: python
version: 1.0.1
inherits: wercker/ubuntu12.04-webessentials@1.0.0
type : main
platform : ubuntu@12.04
description : python
keywords:
  - python
  - virtualenv
  - python 2.7
  - python 3.2
  - python 3.3
  - wheel
packages :
  - python@2.7.3
  - python@3.2.3
  - python@3.3.5
  - setuptools@1.3
  - pip@1.5.4
  - virtualenv@1.11.4
  - wheel@0.22.0
  - psycopg2
script : |
  echo installing python2.7 and python3.2 from apt...
  sudo apt-get update
  sudo apt-get install python python-dev
  sudo apt-get install python3 python3-dev

  echo installing python packages...
  sudo apt-get install python-virtualenv python-setuptools python3-setuptools python3-psycopg2 python-psycopg2

  echo installing python3.3 from source...
  cd /tmp/
  wget http://www.python.org/ftp/python/3.3.5/Python-3.3.5.tgz
  tar -xf Python-3.3.5.tar.bz2
  cd Python-3.3.5
  ./configure --prefix=/usr/bin && make && make install

  echo installing python3.4 from source...
  wget http://www.python.org/ftp/python/3.4.0/Python-3.4.0rc3.tgz
  tar -xf Python-3.4.0rc3.tgz
  cd Python-3.4.0rc3
  ./configure --prefix=/usr/bin && make && make install

  echo installing pip for python2.7...
  wget https://raw.github.com/pypa/pip/master/contrib/get-pip.py
  sudo python2.7 get-pip.py
  pip --version
  sudo cp /usr/local/bin/pip /usr/local/bin/pip-2.7
  sudo rm -rf /usr/local/bin/pip

  echo installing pip for python3.2...
  sudo python3.2 get-pip.py
  sudo cp /usr/local/bin/pip /usr/local/bin/pip-3.2
  sudo rm -rf /usr/local/bin/pip

  echo installing pip for python3.3...
  sudo python3.3 get-pip.py
  sudo cp /usr/local/bin/pip /usr/local/bin/pip-3.3
  sudo rm -rf /usr/local/bin/pip

  cho installing pip for python3.4...
  sudo python3.4 get-pip.py
  sudo cp /usr/local/bin/pip /usr/local/bin/pip-3.4
  sudo rm -rf /usr/local/bin/pips

  echo setting default pip to python2.7...
  sudo cp /usr/local/bin/pip-2.7 /usr/local/bin/pip
  pip --version

  sudo pip-3.4 install virtualenv wheel --upgrade
  sudo pip-3.3 install virtualenv wheel --upgrade
  sudo pip-3.2 install virtualenv wheel --upgrade
  sudo pip-2.7 install virtualenv wheel --upgrade

  sudo chef-solo -c $WERCKER_SOURCE_DIR/solo.rb -j $WERCKER_SOURCE_DIR/solo.json -l debug

box-detect:
  priority : 900
  version :
  detect:
    - files:
      - requirements.txt
    - files:
      - setup.py

default-build:
  python:
    priority : 50
    detect:
      - default: true
    text-to-append: |
      # Build definition
      build:
        # The steps that will be executed on build
        steps:
          # A step that sets up the python virtual environment
          - virtualenv:
              name: setup virtual environment
              install_wheel: true # Enable wheel to speed up builds (experimental)

          # # Use this virtualenv step for python 3.3
          # - virtualenv
          #     name: setup virtual environment
          #     python_location: /usr/bin/python3.3

          # # A step that executes `pip install` command.
          # - pip-install

          # # This pip-install clears the local wheel cache
          # - pip-install:
          #     clean_wheel_dir: true

          # A custom script step, name value is used in the UI
          # and the code value contains the command that get executed
          - script:
              name: echo python information
              code: |
                echo "python version $(python --version) running"
                echo "pip version $(pip --version) running"

